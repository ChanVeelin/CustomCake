<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="CommentMapper">
	<select id="commentListWithPaging" parameterType="hashMap" resultType="comment">
		<![CDATA[
		SELECT comment_no, id, product_no, content, comment_regdate, score, image
          FROM (SELECT row_number() OVER (ORDER BY comment_regdate DESC) rn, 
          comment_no, id, product_no, content, comment_regdate, score, image
                  FROM product_comment
                 WHERE product_no=#{product_no})
         WHERE rn <= #{criteria.pageNum} * #{criteria.rowsPerPage}
           AND  rn > (#{criteria.pageNum}-1) * #{criteria.rowsPerPage}  
        ]]>
	</select>	
	<select id="avgCommentScore" resultType="double">
		select avg(score) from product_comment where product_no=#{product_no}
	</select>
	<select id="countCommentList" resultType="int">
		select count(*) from product_comment
		where product_no=#{product_no}
	</select>
	
	<insert id="saveComment" parameterType="comment">
		INSERT INTO product_comment(comment_no, id, product_no, content)
		VALUES(comment_seq.NEXTVAL, #{id}, #{product_no}, #{content})
	</insert>
</mapper>
